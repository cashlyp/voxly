# --- API Environment --------------------------
# Primary call provider (twilio | aws | vonage)
CALL_PROVIDER=twilio
# Primary SMS provider (twilio | aws | vonage)
SMS_PROVIDER=twilio
# Primary email provider (sendgrid | mailgun | ses)
EMAIL_PROVIDER=sendgrid

# API secret (shared for admin + HMAC signing)
API_SECRET=change-me
# Legacy envs (optional)
# ADMIN_API_TOKEN=
# API_HMAC_SECRET=
API_HMAC_MAX_SKEW_MS=300000

# Twilio credentials (required when CALL_PROVIDER=twilio)
TWILIO_ACCOUNT_SID=
TWILIO_AUTH_TOKEN=
FROM_NUMBER=
TWILIO_GATHER_FALLBACK=true
TWILIO_WEBHOOK_VALIDATION=warn

# Stream auth for WebSocket connections
STREAM_AUTH_SECRET=
STREAM_AUTH_MAX_SKEW_MS=300000

# AWS Connect stack (required when CALL_PROVIDER=aws)
AWS_REGION=us-east-1
AWS_CONNECT_INSTANCE_ID=
AWS_CONNECT_CONTACT_FLOW_ID=
AWS_CONNECT_QUEUE_ID=
AWS_CONNECT_SOURCE_PHONE_NUMBER=
AWS_TRANSCRIPTS_QUEUE_URL=
AWS_EVENT_BUS_NAME=
AWS_WEBHOOK_VALIDATION=warn
# Optional shared secret for AWS callback/stream forwarders that cannot generate API HMAC headers.
AWS_WEBHOOK_SECRET=

# AWS media + speech
AWS_POLLY_VOICE_ID=Joanna
AWS_POLLY_OUTPUT_BUCKET=
AWS_POLLY_OUTPUT_PREFIX=tts/
AWS_MEDIA_BUCKET=
AWS_PINPOINT_APPLICATION_ID=
AWS_PINPOINT_ORIGINATION_NUMBER=
AWS_PINPOINT_REGION=us-east-1
AWS_TRANSCRIBE_LANGUAGE_CODE=en-US
AWS_TRANSCRIBE_VOCABULARY_FILTER_NAME=

# Vonage Voice/SMS (required when CALL_PROVIDER=vonage)
# Provide either the PEM contents (use \n escapes) or a path to the private key file
VONAGE_API_KEY=
VONAGE_API_SECRET=
VONAGE_APPLICATION_ID=
VONAGE_PRIVATE_KEY=
VONAGE_VOICE_FROM_NUMBER=
VONAGE_SMS_FROM_NUMBER=
VONAGE_ANSWER_URL=
VONAGE_EVENT_URL=
# Official Vonage websocket content type is audio/l16 with 8k/16k sample rate.
VONAGE_WEBSOCKET_CONTENT_TYPE=audio/l16;rate=16000
VONAGE_WEBHOOK_VALIDATION=warn
VONAGE_WEBHOOK_SIGNATURE_SECRET=
VONAGE_WEBHOOK_MAX_SKEW_MS=300000
VONAGE_WEBHOOK_REQUIRE_PAYLOAD_HASH=false
# Enable only after configuring Vonage DTMF event callbacks in the Voice app.
VONAGE_DTMF_WEBHOOK_ENABLED=false

# Server configuration
PORT=3000
SERVER=
CORS_ORIGINS=

# OpenRouter AI configuration
OPENROUTER_API_KEY=
OPENROUTER_MODEL=meta-llama/llama-3.1-8b-instruct:free
YOUR_SITE_URL=http://localhost:3000
YOUR_SITE_NAME=Voice Call Bot

# Deepgram configuration
DEEPGRAM_API_KEY=
VOICE_MODEL=aura-asteria-en
DEEPGRAM_MODEL=nova-2

# Telegram webhook fallback
TELEGRAM_BOT_TOKEN=
TELEGRAM_WEBHOOK_VALIDATION=warn
TELEGRAM_ADMIN_CHAT_ID=
TELEGRAM_ADMIN_CHAT_IDS=
TELEGRAM_OPERATOR_CHAT_IDS=
TELEGRAM_VIEWER_CHAT_IDS=

# Email queue + provider request controls
EMAIL_QUEUE_INTERVAL_MS=5000
EMAIL_MAX_RETRIES=5
EMAIL_REQUEST_TIMEOUT_MS=15000
EMAIL_MAX_SUBJECT_CHARS=200
EMAIL_MAX_BODY_CHARS=200000
EMAIL_MAX_BULK_RECIPIENTS=500
EMAIL_DLQ_ALERT_THRESHOLD=25
EMAIL_DLQ_MAX_REPLAYS=2
EMAIL_QUEUE_CLAIM_LEASE_MS=60000
EMAIL_QUEUE_STALE_SENDING_MS=180000
EMAIL_PROVIDER_EVENTS_TTL_DAYS=14
EMAIL_CIRCUIT_BREAKER_ENABLED=true
EMAIL_CIRCUIT_BREAKER_FAILURE_THRESHOLD=5
EMAIL_CIRCUIT_BREAKER_WINDOW_MS=120000
EMAIL_CIRCUIT_BREAKER_COOLDOWN_MS=120000
# Email webhook auth: off | warn | strict
EMAIL_WEBHOOK_VALIDATION=warn
# Optional shared secret for /webhook/email when HMAC headers are not available.
EMAIL_WEBHOOK_SECRET=
# Optional secret to sign/verify one-click unsubscribe links.
EMAIL_UNSUBSCRIBE_SECRET=

# SMS provider/runtime controls
SMS_PROVIDER_TIMEOUT_MS=15000
SMS_AI_TIMEOUT_MS=12000
SMS_MAX_MESSAGE_CHARS=1600

# Outbound send abuse controls (windowed limits)
OUTBOUND_RATE_LIMIT_WINDOW_MS=60000
SMS_OUTBOUND_USER_RATE_LIMIT_PER_WINDOW=15
SMS_OUTBOUND_GLOBAL_RATE_LIMIT_PER_WINDOW=120
EMAIL_OUTBOUND_USER_RATE_LIMIT_PER_WINDOW=20
EMAIL_OUTBOUND_GLOBAL_RATE_LIMIT_PER_WINDOW=120
OUTBOUND_HANDLER_TIMEOUT_MS=30000

# Call recording
RECORDING_ENABLED=false

# Optional defaults
DEFAULT_SMS_BUSINESS_ID=
CONFIG_COMPLIANCE_MODE=safe
DTMF_ENCRYPTION_KEY=

# Inbound call defaults (optional)
INBOUND_PROMPT=
INBOUND_FIRST_MESSAGE=
# Optional pre-connect audio before stream starts
INBOUND_PRECONNECT_MESSAGE=
INBOUND_PRECONNECT_PAUSE_S=1
# Timeout to detect missing media after stream start (ms)
INBOUND_STREAM_FIRST_MEDIA_TIMEOUT_MS=8000
# Inbound rate limiting (0 disables)
INBOUND_RATE_LIMIT_MAX=0
INBOUND_RATE_LIMIT_WINDOW_S=60
INBOUND_RATE_LIMIT_SMS=false
INBOUND_RATE_LIMIT_CALLBACK=false
INBOUND_CALLBACK_DELAY_MIN=15
# JSON object mapping numbers to overrides, e.g. {"+15551234567":{"prompt":"...","first_message":"..."}}
INBOUND_NUMBER_ROUTES=

# Webhook retry backoff (ms + attempts)
WEBHOOK_RETRY_BASE_MS=5000
WEBHOOK_RETRY_MAX_MS=60000
WEBHOOK_RETRY_MAX_ATTEMPTS=5
WEBHOOK_TELEGRAM_TIMEOUT_MS=15000

# Provider failover (outbound)
PROVIDER_FAILOVER_ENABLED=true
PROVIDER_ERROR_THRESHOLD=3
PROVIDER_ERROR_WINDOW_S=120
PROVIDER_COOLDOWN_S=300

# Keypad guard for Vonage digit-capture parity
KEYPAD_GUARD_ENABLED=true
KEYPAD_VONAGE_DTMF_TIMEOUT_MS=12000
KEYPAD_PROVIDER_OVERRIDE_COOLDOWN_S=1800

# Call job processor (durable queue)
CALL_JOB_PROCESSOR_INTERVAL_MS=5000
CALL_JOB_RETRY_BASE_MS=5000
CALL_JOB_RETRY_MAX_MS=60000
CALL_JOB_MAX_ATTEMPTS=3
CALL_JOB_TIMEOUT_MS=45000
CALL_JOB_DLQ_ALERT_THRESHOLD=20
CALL_JOB_DLQ_MAX_REPLAYS=2

# Call SLO thresholds
CALL_SLO_FIRST_MEDIA_MS=4000
CALL_SLO_ANSWER_DELAY_MS=12000
CALL_SLO_STT_FAILURES=3
